# This file is a template, and might need editing before it works on your project.
# see https://docs.gitlab.com/ce/ci/yaml/README.html for all available options

image: registry.gitlab.com/my-privacy-dns/ci-runner

variables:
  GIT_DEPTH: 2

before_script:
  - echo "Before script section"
  - git config --global user.email "4593890-MypDNS@users.noreply.gitlab.com"
  - git config --global user.name "MypDNS"
  - git remote set-url origin https://mypdns:$MypDNS_CI@gitlab.com/$CI_PROJECT_PATH.git

after_script:
  - echo -e "After script section...\n"
  - git add .
  - git status
  - git commit -m 'Auto committed from the CI runner [skip ci]'
  - git push -u origin ${CI_COMMIT_REF_NAME}

build:
  stage: build
  only:
    - master
  script:
    - echo "Building"
    - git checkout -b ${CI_COMMIT_REF_NAME}
    - wget -qO- 'http://data.iana.org/TLD/tlds-alpha-by-domain.txt' | awk '/^(#|$)/{ next }; { printf("%s\n",tolower($1))}' > $CI_PROJECT_DIR/tld.list

test:
  stage: test
  script:
    - echo "Do a test here"
    - wget -qO- 'http://data.iana.org/TLD/tlds-alpha-by-domain.txt' | awk '/^(#|$)/{ next }; { printf("%s\n",tolower($1))}'
